% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/band.R
\name{band}
\alias{band}
\title{Simultaneous Bands for Functional Functional Data (Prediction or Confidence)}
\usage{
band(
  data,
  type = c("prediction", "confidence"),
  alpha = 0.05,
  iid = TRUE,
  id = NULL,
  B = 1000L
)
}
\arguments{
\item{data}{Numeric matrix \code{[T x n]} with rows = time points and columns = curves.
A data.frame of numeric columns is also accepted and will be coerced to a matrix.}

\item{type}{One of \code{c("prediction","confidence")}.
\itemize{
\item \code{"prediction"}: band for a \strong{new individual} curve.
\item \code{"confidence"}: band for the \strong{mean function} \eqn{\mu(t)}.
}}

\item{alpha}{Numeric in (0,1). Use \code{0.05} for 95\\% bands.}

\item{iid}{Logical; if \code{FALSE}, use a \strong{cluster bootstrap} (needs \code{id} or
infers clusters from column-name prefixes).}

\item{id}{Optional integer/factor vector of length \code{ncol(data)} giving a cluster id
for each curve (used when \code{iid = FALSE}). If \code{NULL}, and \code{iid = FALSE},
clusters are inferred from column names by prefix (up to first \verb{_}/\code{-}/\code{.}).}

\item{B}{Integer, number of bootstrap iterations (e.g. 1000 for final results; use smaller in examples/tests).}
}
\value{
A list with
\item{lower}{numeric vector length \code{T} (lower band).}
\item{mean}{numeric vector length \code{T} (estimated mean).}
\item{upper}{numeric vector length \code{T} (upper band).}
\item{meta}{list with settings (type, alpha, iid, B, n, T).}
}
\description{
Create \strong{simultaneous} bootstrap bands for dense functional data (rows = time, cols = curves).
Supports \strong{hierarchical/clustered} designs via a simple cluster bootstrap.
}
\details{
\strong{Simultaneity} is enforced via the max-deviation approach:
\itemize{
\item For \code{type="prediction"}: compute \eqn{M_i = \max_t |Y_i^\*(t) - \hat\mu(t)| / \hat\sigma(t)} and take
\eqn{c_p = Q_{1-\alpha}(M_i)}; then band is \eqn{\hat\mu(t) \pm c_p\,\hat\sigma(t)}.
\item For \code{type="confidence"}: bootstrap the mean curve \eqn{\hat\mu_i^\*(t)}, form
\eqn{C_i = \max_t |\hat\mu_i^\*(t) - \hat\mu(t)| / \widehat{\mathrm{se}}(t)} with
\eqn{\widehat{\mathrm{se}}(t) = \hat\sigma(t)/\sqrt{n}}, then \eqn{c_c = Q_{1-\alpha}(C_i)} and band is
\eqn{\hat\mu(t) \pm c_c\,\widehat{\mathrm{se}}(t)}.
}

Cluster bootstrap (\code{iid = FALSE}): for the \strong{confidence} band we resample \strong{clusters} with replacement
and include all member curves of each drawn cluster until we reach \code{n} curves; for the \strong{prediction} band
we draw one cluster (uniformly over clusters) and then one of its member curves for the residual.
}
\section{Input checks}{

The function errors if \code{data} is not numeric, has <2 rows or <2 columns, or if \code{iid = FALSE}
but no cluster structure can be determined.
}

\examples{
\donttest{
set.seed(1)
T <- 60; n <- 30
Y <- matrix(rnorm(T*n, sd = .3), nrow = T, ncol = n)

# Prediction band (i.i.d.)
fitP <- band(Y, type = "prediction", alpha = 0.1, iid = TRUE, B = 200)

# Confidence band (i.i.d.)
fitC <- band(Y, type = "confidence", alpha = 0.1, iid = TRUE, B = 200)
}

}
